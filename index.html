<!DOCTYPE html>
<html>
<head>
    <title>Test Website</title>

    <script type="text/javascript">
        // Function to set a cookie
        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            var cookieString = name + "=" + (value || "") + expires + "; SameSite=None; Secure; path=/";
            
            document.cookie = cookieString;
        }
    </script>
    <script type="text/javascript" src="//static.klaviyo.com/onsite/js/klaviyo.js?company_id=SEPBCg"></script>

</head>
<body>
    <h1>Site 1 - Page 1</h1>

    <div class="klaviyo-form-TEwA9H"></div>
    
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', (event) => {
            // Include Klaviyo's JavaScript SDK
            var _learnq = _learnq || [];
            _learnq.push(['account', 'SEPBCg']);
            
            document.addEventListener('klaviyo:onload', function(event){
                // Function to handle form submissions
                _learnq.push(['onFormsSubmitSuccess', function ($event, response) {
                    console.log(response);
                    
                    // Try accessing the email with a safer method
                    var email = response?.data?.email || "";  
                    if(email){
                        setCookie('userEmailCookieTest', email, 1); // Set the cookie with the entered email
                        
                        var pageUrl = window.location.href;
    
                        // Define some dummy metadata
                        var metadata = {
                            page_url: pageUrl
                        };
    
                        // Identify a user
                        _learnq.push(['identify', {
                            '$email': email // the user's email
                        }]);
    
                        // Track an event with Klaviyo
                        _learnq.push(['track', 'User Page Tracking', metadata]);
    
                        // Redirect to the next page
                        window.location.href = 'page2.html';
                    }
                }]);
            });
        });
    </script>
    
</body>
</html>
