<!DOCTYPE html>
<html>
<head>
    <title>Test Website</title>
    <script type="text/javascript">
        // Function to set a cookie
        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            var cookieString = name + "=" + (value || "") + expires + "; SameSite=None; Secure; path=/";
            document.cookie = cookieString;
        }

        // Function to get the value of a cookie
        function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length === 2) {
                return parts.pop().split(";").shift();
            }
            return "";
        }

        // Function to initialize Klaviyo on page 2
        function initializeKlaviyo() {
            var email = getCookie('userEmailKla');
            var klaviyo = window.klaviyo || [];
            klaviyo.push(['publicApiKey', 'SEPBCg']); // replace with your public API key

            // Define the onSubmitSuccess callback for the form.
            klaviyo.push(['forms', {
                onSubmitSuccess: function ($form, response) {
                    // Form submission was successful.
                    var email = $form.find('input[name="email"]').val();
                    setCookie('userEmailKla', email, 1);
                    var pageUrl = window.location.href;
                    var metadata = {
                        page_url: pageUrl
                    };
                    klaviyo.push(['identify', {
                        '$email': email
                    }]);
                    klaviyo.push(['track', 'User Page Tracking', metadata]);
                }
            }]);
        }

        // Load the Klaviyo scripts.
        (function () {
            var b = document.createElement('script');
            b.type = 'text/javascript';
            b.async = true;
            b.src = '//static.klaviyo.com/onsite/js/klaviyo.js?company_id=SEPBCg'; // replace with your public API key
            b.onload = initializeKlaviyo; // Initialize Klaviyo after the script is loaded
            var a = document.getElementsByTagName('script')[0];
            a.parentNode.insertBefore(b, a);
        })();
    </script>
</head>
<body>
    <h1>Site 1 - Page 1</h1>
    <div class="klaviyo-form-TEwA9H"></div>
    <button onclick="window.location.href='page2.html'">Go to Page 2</button>
</body>
</html>
